from sqlalchemy import create_engine
from sqlalchemy import Column, Integer, String, Text, ForeignKey
from sqlalchemy.orm import scoped_session, sessionmaker, relationship
from sqlalchemy.ext.declarative import declarative_base
from datetime import datetime

SYSTEM_NAME = 'ubuntu'
engine = create_engine('sqlite:///base_CVE.db')

def get_date():
	date = datetime.now()
	date = strftime('%d.%m.%Y %H:%M')
	return date


db_session = scoped_session(sessionmaker(bind = engine))

Base = declarative_base()
Base.query = db_session.query_property()

class CVE(Base):
	__tablename__ = 'cve'
	id = Column(String, primary_key = True)
	name = Column(String, primary_key = True)
	references = Column(String)
	date = relationship('Date', backref = 'name_os')

	def __init__ (self, id = None, name = None, references = None):
		self.id = id
		self.name = name
		self.references = references

	def __repr__(self):
		return '{} {};'.format(self.id, self.references)

class Date(Base):
	__tablename__ = 'date'
	id = Column(Integer, primary_key = True)
	name = Column(String, ForeignKey('cve.name'))
	date = Column(String)

	def __init__(self, name = None, date = None):
		self.name = name
		self.date = date

	def __repr__(self):
		return 'Дата последнего обновления: {}'.format(self.date)

if __name__ == "__main__":
	Base.metadata.create_all(bind = engine)


